<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>ESAN - Trayectoria histórica</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body>
    <a-scene>
        <a-assets>
            <img id="esan360" src="pasto.jpg">
            <video id="videoUni" src="video2.mp4" loop="false" crossorigin="anonymous" playsinline webkit-playsinline preload="auto"></video>
        </a-assets>

        <a-sky src="#esan360" rotation="0 -90 0"></a-sky>

        <a-sphere
            id="telonNegro"
            radius="60"
            material="color: #000; side: back; transparent: true; opacity: 0; shader: flat"
            animation__oscurecer="property: material.opacity; to: 1; dur: 2500; startEvents: cineStart; easing: easeInOutQuad"
            animation__aclarar="property: material.opacity; to: 0; dur: 1500; startEvents: cineEnd; easing: easeInOutQuad">
        </a-sphere>

        <a-entity id="estrellas" visible="false"></a-entity>

        <a-entity id="grupoVideo" position="0 1.6 -30" visible="false"
            animation__entrar="property: position; to: 0 1.6 -4; dur: 6000; easing: easeOutCubic; startEvents: videoEntra"
            animation__salir="property: position; to: 0 1.6 -30; dur: 4000; easing: easeInQuad; startEvents: videoSale">
            
            <a-video id="pantallaVideo" src="#videoUni" width="5" height="3"></a-video>

            <a-entity id="controles" position="0 -1.8 0.1">
                <a-circle id="btnAtras" class="clickable" color="#FFFFFF" radius="0.18" position="-1.2 0 0">
                    <a-text value="<< 10s" align="center" color="#B22222" width="2"></a-text>
                </a-circle>

                <a-circle id="btnPausa" class="clickable" color="#B22222" radius="0.22" position="-0.6 0 0">
                    <a-text id="txtPausa" value="PAUSA" align="center" color="#FFFFFF" width="2.5"></a-text>
                </a-circle>

                <a-circle id="btnReiniciar" class="clickable" color="#FFFFFF" radius="0.22" position="0 0 0">
                    <a-text value="RESET" align="center" color="#B22222" width="2.5"></a-text>
                </a-circle>

                <a-circle id="btnAdelante" class="clickable" color="#FFFFFF" radius="0.18" position="0.6 0 0">
                    <a-text value="10s >>" align="center" color="#B22222" width="2"></a-text>
                </a-circle>

                <a-circle id="btnDetener" class="clickable" color="#B22222" radius="0.22" position="1.2 0 0">
                    <a-text value="SALIR" align="center" color="#FFFFFF" width="2.5"></a-text>
                </a-circle>
            </a-entity>
        </a-entity>

        <a-entity
            id="contenedorBoton"
            position="0 1.6 -15"
            visible="true"
            animation="property: position; to: 0 1.6 -2.5; dur: 6000; easing: easeOutCubic; delay: 500">
            <a-circle id="btnAccion" class="clickable" color="#000000" opacity="0.8" radius="0.7">
                <a-text id="textoBoton" value="CONOCE NUESTRA\nHISTORIA" align="center" color="#FFFFFF" width="1.2" wrap-count="20"></a-text>
            </a-circle>
        </a-entity>

        <a-entity camera look-controls position="0 1.6 0">
            <a-cursor color="#FFD700" radius="0.015" scale="0.3 0.3 0.3" raycaster="objects: .clickable"></a-cursor>
        </a-entity>
    </a-scene>

    <script>
        const video = document.getElementById('videoUni');
        const grupoVideo = document.querySelector('#grupoVideo');
        const contenedorBtn = document.querySelector('#contenedorBoton');
        const textoBoton = document.querySelector('#textoBoton');
        const btnAccion = document.querySelector('#btnAccion');
        const telonNegro = document.querySelector('#telonNegro');
        const estrellasContainer = document.querySelector('#estrellas');
        const txtPausa = document.querySelector('#txtPausa');

        // Generar estrellas
        for (let i = 0; i < 500; i++) {
            let estrella = document.createElement('a-sphere');
            let theta = Math.random() * Math.PI * 2;
            let phi = Math.acos((Math.random() * 2) - 1);
            let x = 50 * Math.sin(phi) * Math.cos(theta);
            let y = 50 * Math.sin(phi) * Math.sin(theta);
            let z = 50 * Math.cos(phi);
            estrella.setAttribute('position', `${x} ${y} ${z}`);
            estrella.setAttribute('radius', Math.random() * 0.15);
            estrella.setAttribute('material', 'color: #FFF; shader: flat');
            estrellasContainer.appendChild(estrella);
        }

        function finalizarCine() {
            video.pause();
            telonNegro.emit('cineEnd');
            grupoVideo.emit('videoSale');
            estrellasContainer.setAttribute('visible', 'false');

            // El botón aparece inmediatamente después de que el video se aleja un poco
            setTimeout(() => {
                grupoVideo.setAttribute('visible', 'false');
                textoBoton.setAttribute('value', 'VUELVE A VER\nNUESTRA\nHISTORIA');
                contenedorBtn.setAttribute('position', '0 1.6 -15');
                contenedorBtn.setAttribute('visible', 'true');
                // Forzamos la animación de entrada del botón
                contenedorBtn.setAttribute('animation', "property: position; to: 0 1.6 -2.5; dur: 4000; easing: easeOutCubic");
            }, 1500); 
        }

        btnAccion.addEventListener('click', function() {
            contenedorBtn.setAttribute('visible', 'false');
            telonNegro.emit('cineStart');
            estrellasContainer.setAttribute('visible', 'true');
            grupoVideo.setAttribute('visible', 'true');
            grupoVideo.emit('videoEntra');
            video.currentTime = 0;
            video.play();
            txtPausa.setAttribute('value', 'PAUSA');
        });

        // LÓGICA DE CONTROLES
        document.querySelector('#btnPausa').addEventListener('click', function() {
            if (video.paused) { video.play(); txtPausa.setAttribute('value', 'PAUSA'); }
            else { video.pause(); txtPausa.setAttribute('value', 'PLAY'); }
        });

        document.querySelector('#btnReiniciar').addEventListener('click', function() {
            video.currentTime = 0;
            video.play();
        });

        // AVANCE Y RETROCESO FORZADO (Independiente del video)
        document.querySelector('#btnAtras').addEventListener('click', function() {
            video.currentTime -= 10;
        });

        document.querySelector('#btnAdelante').addEventListener('click', function() {
            video.currentTime += 10;
        });

        document.querySelector('#btnDetener').addEventListener('click', finalizarCine);
        video.addEventListener('ended', finalizarCine);
    </script>
</body>
</html>










